# irTest
tests/functional/01_mm1.sy OK 0H-0M-3S-68269us [ best 0H-0M-2S-845905us]
tests/functional/01_mm2.sy OK 0H-0M-2S-691578us [ best 0H-0M-2S-641348us]
tests/functional/01_mm3.sy OK 0H-0M-1S-900121us [ best 0H-0M-2S-249855us]
tests/functional/03_sort1.sy OK 0H-0M-0S-819329us [ best 0H-0M-1S-204371us]
tests/functional/03_sort2.sy OK 0H-0M-14S-762583us [ best 0H-0M-15S-589579us]
tests/functional/03_sort3.sy OK 0H-0M-0S-120160us [ best 0H-0M-0S-155980us]
tests/functional/04_spmv1.sy OK 0H-0M-1S-707354us [ best 0H-0M-1S-330170us]
tests/functional/04_spmv2.sy OK 0H-0M-0S-951502us [ best 0H-0M-1S-220976us]
tests/functional/04_spmv3.sy OK 0H-0M-1S-454626us [ best 0H-0M-1S-310720us]
tests/functional/crypto-1.sy OK 0H-0M-4S-861735us [ best 0H-0M-0S-857220us]
tests/functional/crypto-2.sy OK 0H-0M-4S-219492us [ best 0H-0M-0S-955470us]
tests/functional/crypto-3.sy OK 0H-0M-5S-374148us [ best 0H-0M-1S-165011us]
tests/functional/fft0.sy OK 0H-0M-5S-353578us [ best 0H-0M-4S-4930us]
tests/functional/fft1.sy OK 0H-0M-11S-391963us [ best 0H-0M-9S-972312us]
tests/functional/fft2.sy OK 0H-0M-0S-63087us [ best 0H-0M-0S-42916us]
tests/functional/gameoflife-gosper.sy OK 0H-0M-7S-580611us [ gcc 0H-0M-5S-908005us ] [ best 0H-0M-8S-729586us]
tests/functional/gameoflife-oscillator.sy OK 0H-0M-6S-853517us [ gcc 0H-0M-5S-343832us ] [ best 0H-0M-7S-578715us]
tests/functional/gameoflife-p61glidergun.sy OK 0H-0M-7S-2672us [ gcc 0H-0M-5S-117752us ] [ best 0H-0M-8S-193014us]
tests/functional/h-1-01.sy OK 0H-0M-56S-168916us [ best 0H-1M-5S-320066us]
tests/functional/h-1-02.sy OK 0H-0M-4S-674071us [ best 0H-0M-4S-950537us]
tests/functional/h-1-03.sy OK 0H-0M-27S-327408us [ best 0H-0M-28S-806873us]
tests/functional/h-10-01.sy OK 0H-0M-0S-25788us [ best 0H-0M-0S-9991us]
tests/functional/h-10-02.sy OK 0H-0M-6S-371279us [ best 0H-0M-5S-993288us]
tests/functional/h-11-01.sy OK 0H-1M-2S-470006us [ best 0H-0M-49S-576988us]
tests/functional/h-12-01.sy è¾“å‡ºä¸ä¸€è‡´
tests/functional/h-13-01.sy è¾“å‡ºä¸ä¸€è‡´
tests/functional/h-14-01.sy è¾“å‡ºä¸ä¸€è‡´
tests/functional/h-2-01.sy OK 0H-0M-11S-779548us [ best 0H-0M-12S-447854us]
tests/functional/h-2-02.sy OK 0H-0M-11S-653434us [ best 0H-0M-11S-857632us]
tests/functional/h-2-03.sy OK 0H-0M-14S-572356us [ best 0H-0M-14S-331704us]
tests/functional/h-4-01.sy OK 0H-0M-3S-304540us [ best 0H-0M-3S-215095us]
tests/functional/h-4-02.sy OK 0H-0M-11S-321951us [ best 0H-0M-12S-312266us]
tests/functional/h-4-03.sy OK 0H-0M-20S-537131us [ best 0H-0M-21S-845723us]
tests/functional/h-5-01.sy OK 0H-0M-1S-834236us [ best 0H-0M-2S-971240us]
tests/functional/h-5-02.sy OK 0H-0M-1S-782557us [ best 0H-0M-2S-334598us]
tests/functional/h-5-03.sy OK 0H-0M-1S-871936us [ best 0H-0M-1S-947688us]
tests/functional/h-7-01.sy è¾“å‡ºä¸ä¸€è‡´
tests/functional/h-8-01.sy OK 0H-0M-1S-592751us [ best 0H-0M-1S-688795us]
tests/functional/h-8-02.sy OK 0H-0M-1S-623670us [ best 0H-0M-1S-652662us]
tests/functional/h-8-03.sy OK 0H-0M-1S-629832us [ best 0H-0M-2S-93087us]
tests/functional/h-9-01.sy OK 0H-0M-0S-427223us [ best 0H-0M-0S-508852us]
tests/functional/h-9-02.sy OK 0H-0M-4S-966559us [ best 0H-0M-4S-932146us]
tests/functional/h-9-03.sy OK 0H-0M-0S-107447us [ best 0H-0M-0S-111663us]
tests/functional/if-combine1.sy OK 0H-0M-0S-46443us [ best 0H-0M-0S-51976us]
tests/functional/if-combine2.sy OK 0H-0M-8S-50333us [ best 0H-0M-7S-816776us]
tests/functional/if-combine3.sy OK 0H-0M-14S-55149us [ best 0H-0M-12S-677942us]
tests/functional/matmul1.sy OK 0H-0M-6S-111415us [ best 0H-0M-4S-366262us]
tests/functional/matmul2.sy OK 0H-0M-6S-213356us [ best 0H-0M-4S-542577us]
tests/functional/matmul3.sy OK 0H-0M-5S-692159us [ best 0H-0M-4S-440288us]
tests/functional/shuffle0.sy OK 0H-0M-1S-860098us [ best 0H-0M-1S-701230us]
tests/functional/shuffle1.sy OK 0H-0M-1S-778403us [ best 0H-0M-1S-388164us]
tests/functional/shuffle2.sy OK 0H-0M-0S-82915us [ best 0H-0M-0S-112374us]
tests/functional/sl1.sy OK 0H-0M-2S-125256us [ best 0H-0M-2S-234105us]
tests/functional/sl2.sy OK 0H-0M-0S-627864us [ best 0H-0M-0S-583399us]
tests/functional/sl3.sy OK 0H-0M-0S-338585us [ best 0H-0M-0S-317387us]
tests/functional/sort_search.sy OK 0H-0M-0S-369701us
tests/functional/transpose0.sy OK 0H-0M-1S-231587us [ best 0H-0M-1S-266085us]
tests/functional/transpose1.sy OK 0H-0M-1S-713414us [ best 0H-0M-1S-812821us]
tests/functional/transpose2.sy OK 0H-0M-3S-376506us [ best 0H-0M-2S-916103us]
 [ best 0H-6M-19S-892148us] / 100H-6M-5S-184315us

è„šæœ¬å‘½ä»¤ä¸åŠ O1å°±æ…¢å¾ˆå¤šä½†æ˜¯æ²¡æœ‰æº¢å‡ºäº†

åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ï¼Œå¼€å¯ O1 ä¼˜åŒ–åç¨‹åºè¿è¡Œæ—¶é—´æ˜æ˜¾ä¸‹é™ï¼Œä½†éƒ¨åˆ†æµ‹è¯•ç”¨ä¾‹ï¼ˆå¦‚ sort_searchï¼‰ç”±äºæºç ä¸­å­˜åœ¨æ•´æ•°æº¢å‡ºç­‰æœªå®šä¹‰è¡Œä¸ºï¼Œåœ¨æ¿€è¿›ä¼˜åŒ–ä¸‹å¯èƒ½è§¦å‘ç¼–è¯‘å‘Šè­¦æˆ–è¡Œä¸ºå·®å¼‚ã€‚å› æ­¤ï¼Œåœ¨åŠŸèƒ½æ­£ç¡®æ€§æµ‹è¯•é˜¶æ®µæœªé»˜è®¤å¯ç”¨ O1 ä¼˜åŒ–ï¼Œä»¥ä¿è¯è¯­ä¹‰ä¸€è‡´æ€§ï¼›åœ¨æ€§èƒ½åˆ†æä¸ä¼˜åŒ–å±•ç¤ºé˜¶æ®µï¼Œå•ç‹¬å¯ç”¨ O1 ç”¨äºè¯„ä¼°ä¼˜åŒ–æ•ˆæœã€‚

# astTest
åªæµ‹ AST ä¼šæ…¢å¾ˆå¤šï¼Œæ˜¯å› ä¸ºè¿™æ—¶æµ‹è¯•æ—¶é—´å‡ ä¹å…¨éƒ¨æ¥è‡ªâ€œç¼–è¯‘é˜¶æ®µæœ¬èº«â€ï¼Œè€Œä¸æ˜¯ç¨‹åºè¿è¡Œé˜¶æ®µï¼›è€Œ AST é˜¶æ®µæ°å¥½æ˜¯æœ¬é¡¹ç›®ä¸­æœ€é‡ã€ä½†åˆæœ€éš¾è¢«ä¼˜åŒ–çš„é˜¶æ®µã€‚

æ¢å¥è¯è¯´ï¼šç°åœ¨æµ‹åˆ°çš„æ˜¯â€œç¼–è¯‘å™¨å‰ç«¯æ€§èƒ½â€ï¼Œä¸æ˜¯ç”Ÿæˆä»£ç çš„æ€§èƒ½

AST é˜¶æ®µåšäº†ä»€ä¹ˆï¼Ÿ

ANTLR è¯æ³•åˆ†æï¼ˆå¤§é‡å­—ç¬¦ä¸²å¤„ç†ï¼‰

è¯­æ³•åˆ†æï¼ˆé€’å½’ä¸‹é™ / è‡ªåŠ¨æœºï¼‰

Parse Tree â†’ AST è½¬æ¢

AST èŠ‚ç‚¹å¯¹è±¡é¢‘ç¹ new / delete

Visitor å¤šæ¬¡éå† AST

å¯¹äºè¿™äº›ç¨‹åºï¼š

mm1/mm2/mm3ï¼ˆçŸ©é˜µï¼‰

sort1/2/3

ç‰¹ç‚¹æ˜¯ï¼š

æºç éå¸¸é•¿

è¡¨è¾¾å¼å’Œå¾ªç¯å±‚æ¬¡å¤š

AST èŠ‚ç‚¹æ•°é‡æå¤§

ğŸ‘‰ AST æ„å»ºæ—¶é—´ âˆ æºç è§„æ¨¡ï¼Œè€Œä¸æ˜¯è¿è¡Œè§„æ¨¡

2ï¸âƒ£ AST é˜¶æ®µå‡ ä¹â€œæ²¡æœ‰ä¼˜åŒ–å¯è¨€â€

æ³¨æ„ä¸€ä¸ªéå¸¸é‡è¦ä½†å®¹æ˜“å¿½ç•¥çš„ç‚¹ï¼š

é˜¶æ®µ	æ˜¯å¦èƒ½æ˜æ˜¾æé€Ÿ
AST / è¯­æ³•åˆ†æ	âŒ å‡ ä¹ä¸èƒ½
IR ä¼˜åŒ–	âœ… å¯ä»¥
åç«¯ä»£ç ç”Ÿæˆ	âœ… å¯ä»¥
è¿è¡Œç¨‹åº	âœ… éå¸¸æ˜æ˜¾

3ï¸âƒ£ å®Œæ•´æµç¨‹é‡Œï¼Œè¿è¡Œæ—¶é—´â€œæ©ç›–â€äº†ç¼–è¯‘æ—¶é—´

åœ¨å®Œæ•´æµ‹è¯•ä¸­ï¼š

æ€»æ—¶é—´ = ç¼–è¯‘æ—¶é—´ + ç¨‹åºè¿è¡Œæ—¶é—´


è€Œåƒ mm / sortï¼š

ç¨‹åºæœ¬èº«å°±è¦è·‘å¥½å‡ ç§’

ç¼–è¯‘é˜¶æ®µåªå ä¸€éƒ¨åˆ†

ğŸ‘‰ æ‰€ä»¥ä½ æ„Ÿè§‰ä¸å‡º AST æ…¢

è€Œ AST-only æµ‹è¯•ä¸­ï¼š

æ€»æ—¶é—´ â‰ˆ ç¼–è¯‘æ—¶é—´


ğŸ‘‰ ç¼–è¯‘å™¨å‰ç«¯çš„æ…¢è¢«å®Œæ•´æš´éœ²å‡ºæ¥äº†

4ï¸âƒ£ ç¬¬ä¸€ä¸ªå°±æ…¢ï¼Œæ˜¯â€œå†·å¯åŠ¨æ•ˆåº”â€ï¼ˆä¸æ˜¯ä½ ä»£ç é—®é¢˜ï¼‰

ä½ ç»™çš„æ•°æ®éå¸¸å…¸å‹ï¼š

01_mm1 7.15s
01_mm2 6.41s
01_mm3 4.72s


è¿™æ˜¯å› ä¸ºï¼š

ç¬¬ä¸€æ¬¡ï¼š

åŠ è½½ antlr ç›¸å…³åº“

åˆå§‹åŒ– C++ runtime

åˆ†é…å¤§é‡å †å†…å­˜ï¼ˆmalloc arenaï¼‰

åç»­ï¼š

allocator å·²çƒ­

ä»£ç é¡µ / æ•°æ®é¡µåœ¨ cache ä¸­

ğŸ‘‰ è¿™å«å†·å¯åŠ¨æˆæœ¬ï¼Œä¸æ˜¯ç®—æ³•é€€åŒ–

ä¸‰ã€è¿™å’Œ O1 / ä¼˜åŒ–æœ‰æ²¡æœ‰å…³ç³»ï¼Ÿ

å‡ ä¹ æ²¡æœ‰å…³ç³»ã€‚

åŸå› ï¼š

AST æ„å»ºå‘ç”Ÿåœ¨ï¼š

ä½ ç¼–è¯‘å™¨è‡ªå·±çš„ C++ ä»£ç é‡Œ

-O1 ä¼˜åŒ–çš„æ˜¯ï¼š

è¢«ç¼–è¯‘çš„ SysY ç¨‹åº

ä¸æ˜¯ï¼š

ç¼–è¯‘å™¨è‡ªèº«



ä¸ç®¡ä½ å¯¹ SysY ç¨‹åºå¼€ä¸å¼€ O1ï¼ŒAST é˜¶æ®µéƒ½ä¼šæ…¢
æ¯”èµ› / è¯¾ç¨‹è®¾è®¡å…³æ³¨çš„æ˜¯ï¼š

åŠŸèƒ½æ­£ç¡®æ€§

ä¸­åç«¯ä¼˜åŒ–æ•ˆæœ

ç”Ÿæˆä»£ç è´¨é‡

å‡ ä¹æ²¡äººè¦æ±‚ AST æ„å»ºè¦å¿«

LLVM / GCC çš„å‰ç«¯ä¸€æ ·æ…¢ï¼Œåªæ˜¯ä½ å¹³æ—¶æ„Ÿè§‰ä¸åˆ°ã€‚

äº”ã€æŠ¥å‘Šé‡Œå¯ä»¥è¿™æ ·å†™ï¼ˆç›´æ¥å¯ç”¨ï¼‰
æŠ¥å‘Šè¡¨è¿°ï¼ˆæ¨èï¼‰

åœ¨ä»…è¿›è¡Œ AST æ„å»ºä¸å‰ç«¯åˆ†æçš„æµ‹è¯•æ¨¡å¼ä¸‹ï¼Œç¨‹åºæ•´ä½“è€—æ—¶æ˜æ˜¾é«˜äºå®Œæ•´ç¼–è¯‘æµç¨‹ã€‚è¿™æ˜¯ç”±äº AST é˜¶æ®µä¸»è¦æ¶ˆè€—åœ¨è¯æ³•ã€è¯­æ³•åˆ†æåŠæŠ½è±¡è¯­æ³•æ ‘æ„å»ºè¿‡ç¨‹ï¼Œè¯¥é˜¶æ®µæ¶‰åŠå¤§é‡å¯¹è±¡åˆ›å»ºä¸æ ‘ç»“æ„éå†ï¼Œä¸”éš¾ä»¥é€šè¿‡ä¼ ç»Ÿç¼–è¯‘ä¼˜åŒ–æ‰‹æ®µè¿›è¡ŒåŠ é€Ÿã€‚åœ¨å®Œæ•´ç¼–è¯‘ä¸æ‰§è¡Œæµç¨‹ä¸­ï¼Œç¨‹åºè¿è¡Œæ—¶é—´åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ©ç›–äº†å‰ç«¯ç¼–è¯‘å¼€é”€ï¼Œå› æ­¤æ•´ä½“è¡¨ç°åè€Œæ›´å¿«ã€‚è¯¥ç°è±¡å±äºç¼–è¯‘å™¨å‰ç«¯çš„å…¸å‹ç‰¹å¾ï¼Œå¹¶ä¸å½±å“åç«¯ä¼˜åŒ–ä¸ä»£ç ç”Ÿæˆæ•ˆæœã€‚